<div class="top-bar">
    <p>Summer Sale For All Swim Suits And Free Express Delivery - OFF 50%! <a href="#"
            style="color: #fff; text-decoration: underline;">Shop Now</a></p>
</div>
<div class="container">
    <div class="nav-container">
        <div class="logo">QATECH</div>
        <div class="nav-links">
            <a href="/">Home</a>

            <% if (typeof existingUser !=="undefined" && existingUser) { %>
                <a>Xin chào, <%= existingUser.name %>!</a>
                <a href="/user-orders/<%= existingUser._id %>">Đơn Hàng Của Tôi</a>
                <form action="/auth/logout" method="POST"><button class="btn btn-primary" type="submit"><a>Đăng
                            xuất</a></button></form>
                <% } else { %>
                    <a href="/auth/login">Đăng nhập</a>
                    <% } %>

        </div>
        <div class="nav-icons">
            <div class="search-container">
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="What are you looking for?"
                        oninput="searchProducts(this.value)">
                    <button><i class="fas fa-search"></i></button>
                </div>
                <ul id="searchResults" class="results-list"></ul>
            </div>
            <% if(existingUser) { %>
                <a href="/cart/<%= existingUser._id %>"><i class="fas fa-shopping-cart"></i></a>
                <% } else { %>
                    <a href="/cart/"><i class="fas fa-shopping-cart"></i></a>
                    <%} %>
                        <a href="/user"><i class="fas fa-user"></i></a>
        </div>
    </div>
</div>
<div class="category-nav">
    <div class="container">
        <div class="category-list">
            <a href="/shop-page/GPU">Graphics Card</a>
            <a href="/shop-page/CPU">CPU</a>
            <a href="/shop-page/Mainboards">Mainboards</a>
            <a href="/shop-page/PSU">PSU</a>
            <a href="/shop-page/RAM">RAM</a>
            <a href="/shop-page/HDD">HDD</a>
            <a href="/shop-page/Monitors">Monitors</a>
            <a href="/shop-page/SSD">SSD</a>
            <a href="/shop-page/Case">Case PC</a>
        </div>
    </div>
</div>

<script>
    async function searchProducts(query) {
        const list = document.getElementById("searchResults");
        list.innerHTML = "";

        if (!query.trim()) {
            list.style.display = "none";
            return;
        }

        const res = await fetch(`/search-product?keyword=${encodeURIComponent(query)}`);
        const products = await res.json();

        if (products.length === 0) {
            list.innerHTML = `<li>Không tìm thấy sản phẩm</li>`;
            list.style.display = "block";
            return;
        }

        products.forEach(p => {
            const li = document.createElement("li");
            li.classList.add("search-item");

            const img = document.createElement("img");
            img.src = p.images[0].url;
            img.alt = p.name;
            const name = document.createElement("span");
            name.textContent = p.name;

            li.onclick = () => window.location.href = `/shop/${p.category}/${p._id}`;

            li.appendChild(img);
            li.appendChild(name);
            list.appendChild(li);
        });


        list.style.display = "block";
    }
</script>
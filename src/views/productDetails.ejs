<link rel="stylesheet" href="/asset/css/product-details.css">
<!-- Product Details Content -->
<main>
    <div class="container">
        <div class="breadcrumb">
            <a href="/">Home</a> / <a href="/shop-page/<%= getProducts.category%>">
                <%= getProducts.category%>
            </a>
            <span>
                / <%= getProducts.name %>
            </span>
        </div>

        <div class="product-details">
            <!-- Gallery (ảnh bên trái) -->
            <div class="product-gallery">
                <div class="thumbnail-list">
                    <% getProducts.images.forEach(function(img, index){ %>
                        <img src="<%= img.url %>" class="thumbnail <%= index === 0 ? 'active' : '' %>"
                            data-index="<%= index %>">
                        <% }); %>
                </div>

                <div class="main-image">
                    <img id="mainProductImage" src="<%= getProducts.images[0].url %>" alt="<%= getProducts.name %>">
                </div>
            </div>

            <!-- Info + quantity + action buttons (bên phải) -->
            <div class="product-info-details">
                <h1 class="product-title-details">
                    <%= getProducts.name %>
                </h1>

                <div class="product-rating-details">
                    <div class="product-rating">
                        <i class="fas fa-star"></i><i class="fas fa-star"></i>
                        <i class="fas fa-star"></i><i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <span>(150 Reviews)</span>
                    </div>
                    <span>In Stock: <%=getProducts.stock %></span>
                </div>
                <% let discount=getProducts.discountPercent; let price=getProducts.price; let finalPrice=price * ( 1 -
                    discount / 100 ); finalPrice=finalPrice.toFixed(2); %>
                    <div class="product-price-details">$<%= finalPrice %>
                    </div>
                    <span class="original-price">
                        <%= getProducts.price %>$
                    </span>

                    <p class="product-description">
                        <%= getProducts.description %>
                    </p>
                    <% if(getProducts.stock===0) { %>
                        <h2>Sold Out!</h2>
                        <% } else { %>
                            <form action="/add-cart/<%= getProducts._id %>" method="POST" onsubmit="setQuantity()">
                                <!-- Quantity + Buy Now -->
                                <div class="quantity-selector">
                                    <button type="button" class="quantity-btn">-</button>
                                    <span id="qty" class="quantity-value">1</span>
                                    <button data-stock="<%= getProducts.stock%>" type="button"
                                        class="quantity-btn">+</button>
                                </div>
                                <input type="hidden" name="quantity" class="quantityInput">

                                <!-- Action buttons -->
                                <div class="action-buttons">
                                    <button type="submit" class="add-to-cart-btn"><i class="fas fa-shopping-cart"></i>
                                        Add To
                                        Cart</button>
                                </div>
                            </form>
                            <% } %>
            </div>
        </div>


        <div class="product-info-details">
            <h1 class="product-title-details">
                <%= getProducts.name %>
            </h1>

            <div class="product-rating-details">
                <% if(getProducts.stock===0) { %>
                    <span style="color: #f02323;">Sold Out</span>
                    <% } else { %>
                        <h2 style="color: #00FF66;">In Stock</h2>
                        <% } %>
            </div>
            <div class="product-price-details">$<%= finalPrice %>
            </div>

            <p class="product-description">
                <%= getProducts.details.description %>
            </p>
            <p class="product-specifications">
                <%= getProducts.details.specifications %>
            </p>

            <!-- Delivery info -->
            <div class="delivery-info">
                <div class="delivery-item">
                    <div class="delivery-icon"><i class="fas fa-truck"></i></div>
                    <div>
                        <div style="font-weight: 500;">Free Delivery</div>
                        <div>Enter your postal code for Delivery Availability</div>
                    </div>
                </div>
                <div class="delivery-item">
                    <div class="delivery-icon"><i class="fas fa-undo"></i></div>
                    <div>
                        <div style="font-weight: 500;">Return Delivery</div>
                        <div>Free 30 Days Delivery Returns, Details</div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <section class="related-products">
        <h2 class="section-title">Related Item</h2>
        <% if(relatedProducts.length===0){ %>
            <h2 class="section-title">Hiện Chưa Có Sản Phẩm Liên Quan</h2>
            <% }else{ %>
                <div class="related-products-grid">
                    <!-- Related Product 1 -->
                    <% relatedProducts.forEach(function(product) { %>
                        <a href="/shop/<%= product.category%>/<%= product._id %>" class="product-card">
                            <div class="product-image">
                                <div class="discount-badge">
                                    <%= product.discountPercent %>%
                                </div>
                                <img class="img-main" src="<%= product.images[0].url %>"
                                    style="width: 100%; height: 100%; background-color: #f0f0f0; display: flex; align-items: center; justify-content: center;">
                                <% const randomIndex=Math.floor(Math.random() * product.images.length); %>
                                    <img style="width: 100%; height: 100%; background-color: #f0f0f0; display: flex; align-items: center; justify-content: center;"
                                        src="<%= product.images[randomIndex].url %>" class="img-hover">
                            </div>
                            <div class="product-info">
                                <h3 class="product-title">
                                    <%= product.name %>
                                </h3>
                                <% let discount=product.discountPercent; let price=product.price; let finalPrice=price *
                                    ( 1 - discount/ 100); finalPrice=finalPrice.toFixed(2); %>
                                    <div class="product-price">
                                        <span class="current-price">
                                            <%= finalPrice %>$
                                        </span>
                                        <span class="original-price">
                                            <%= product.price %>$
                                        </span>
                                    </div>
                                    <div class="product-rating">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <span>(88)</span>
                                    </div>
                            </div>
                        </a>
                        <% }) %>
                            <%} %>
                </div>
    </section>
    </div>
</main>
<script>
    const thumbnails = document.querySelectorAll('.thumbnail');
    const mainImage = document.getElementById('mainProductImage');

    thumbnails.forEach(thumb => {
        thumb.addEventListener('click', () => {
            thumbnails.forEach(t => t.classList.remove('active'));
            thumb.classList.add('active');
            mainImage.src = thumb.src;
        });
    });

    // Quantity selector
    const quantityValue = document.querySelector('.quantity-value');
    const minusBtn = document.querySelector('.quantity-btn:first-child');
    const plusBtn = document.querySelector('.quantity-btn:last-child');

    minusBtn.addEventListener('click', function () {
        let value = parseInt(quantityValue.textContent);
        if (value > 1) {
            quantityValue.textContent = value - 1;
        }
    });
    //
    plusBtn.addEventListener('click', function () {
        var stock = plusBtn.getAttribute("data-stock");
        let value = parseInt(quantityValue.textContent);
        if (value < stock) {
            quantityValue.textContent = value + 1;
        }
    });

    function setQuantity() {
        document.querySelector(".quantityInput").value =
            document.getElementById("qty").innerText;
    }


</script>